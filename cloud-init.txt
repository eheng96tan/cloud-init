
#!/bin/sh
echo -e "new_password" | (passwd --stdin centos)

#cloud-config
 
package_upgrade: true
package:
 - epel-release
 - ntp
 - fail2ban
 - fail2ban-systemd

runcmd:
 - [ sudo, yum, update, "-y" ]
 - [ ntpdate, "pool.ntp.org" ]
 - [ sudo, systemctl, enable, ntpd ]
 - [ sudo, systemctl, start, ntpd ]
 - [ sudo, systemctl, enable, firewalld ]
 - [ sudo, systemctl, start, firewalld ]
 - [ sudo, systemctl, enable, fail2ban ]
 - [ sudo, systemctl, start, fail2ban ]
 - [ sudo, sed, -i, -e, 's/PasswordAuthentication no/PasswordAuthentication yes/g', /etc/ssh/sshd_config ]
 
power_state:
 delay: "+10"
 mode: reboot
 message: Rebooting
 timeout: 30
 condition: True
